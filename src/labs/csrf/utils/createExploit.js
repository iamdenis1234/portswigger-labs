import { parse } from "node-html-parser";
import { getFileContent } from "../../../utils/getFileContent.js";

export { createExploit };

async function createExploit(
  filePath,
  options = {
    actionUrl: "",
    csrfToken: "",
  },
) {
  const html = await getFileContent(filePath);
  const parsedHtml = parse(html);
  const form = parsedHtml.querySelector("form");

  if (options.actionUrl) {
    form.setAttribute("action", options.actionUrl);
  }

  if (options.csrfToken) {
    const csrfInput = form.querySelector("input[name='csrf']");
    csrfInput.setAttribute("value", options.csrfToken);
  }

  return parsedHtml.toString();
}
