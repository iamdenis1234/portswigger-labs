import { parse } from "node-html-parser";

export { Exploit };

class Exploit {
  readonly #parsedHtml;
  readonly #form;

  constructor(rawHtml: string) {
    this.#parsedHtml = parse(rawHtml);
    const form = this.#parsedHtml.querySelector("form");
    if (!form) throw new Error('No "form" element found');
    this.#form = form;
  }

  setFormAction(action: string) {
    this.#form.setAttribute("action", action);
  }

  setCsrfToken(token: string) {
    const csrfInput = this.#form.querySelector("input[name='csrf']");
    if (!csrfInput) throw new Error('No input element with name "csrf" found');
    csrfInput.setAttribute("value", token);
  }

  toString() {
    return this.#parsedHtml.toString();
  }
}
